import { EmbedBuilder } from "discord.js";
import { ShopItem } from "../../utils/database.js";

export default {
  name: "addrole",
  description: "Adiciona um cargo √† loja (admin only)",
  async execute(message, args) {
    if (!message.member.permissions.has("Administrator")) {
      return message.reply("‚ùå Voc√™ n√£o tem permiss√£o para isso.");
    }

    if (args.length < 2) {
      return message.reply("‚ùå Use: `!addrole {nome-do-item} {@cargo} {pre√ßo}`");
    }

    // Separar nome do item, cargo e pre√ßo
    const role = message.mentions.roles.first();
    if (!role) return message.reply("‚ùå Voc√™ precisa mencionar o cargo.");

    // Remover a men√ß√£o do cargo dos argumentos
    const mentionIndex = args.findIndex(a => a.includes(role.id));
    const itemName = args.slice(0, mentionIndex).join(" ");
    const priceArg = args.slice(mentionIndex + 1).join(" ");
    const price = parseInt(priceArg);

    if (isNaN(price) || price < 0) return message.reply("‚ùå Pre√ßo inv√°lido.");

    // Adicionar √† loja
    await ShopItem.upsert({
      item: itemName,
      price,
      type: "role",
      reference: role.id
    });

    const embed = new EmbedBuilder()
      .setTitle("üõí Cargo adicionado √† loja!")
      .setDescription(`‚úÖ O cargo **${role.name}** foi adicionado √† loja como **${itemName}** por ${price} coins.`)
      .setColor("Blue");

    return message.channel.send({ embeds: [embed] });
  }
};
