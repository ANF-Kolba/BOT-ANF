import { EmbedBuilder } from "discord.js";
import { ShopItem, Cosmetic } from "../../utils/database.js";

export default {
  name: "removeshop",
  description: "Remove um item, cosm√©tico ou cargo da loja (admin only)",
  async execute(message, args) {
    if (!message.member.permissions.has("Administrator")) {
      return message.reply("‚ùå Voc√™ n√£o tem permiss√£o para isso.");
    }

    if (!args.length) return message.reply("‚ùå Use: `!removeshop {nome-do-item}` ou `!removeshop {@role}`");

    const input = args.join(" ");

    try {
      let shopItem = await ShopItem.findOne({ where: { item: input } });

      // Se n√£o encontrar, tenta cargo mencionado
      if (!shopItem && message.mentions.roles.size > 0) {
        const role = message.mentions.roles.first();
        shopItem = await ShopItem.findOne({ where: { reference: role.id, type: "role" } });
      }

      if (shopItem) {
        await shopItem.destroy();
        return message.channel.send({
          embeds: [
            new EmbedBuilder()
              .setTitle("üõí Item removido da loja!")
              .setDescription(`‚úÖ O item/cargo **${input}** foi removido da loja com sucesso.`)
              .setColor("Red"),
          ],
        });
      }

      // Tenta remover cosm√©tico
      const cosmetic = await Cosmetic.findOne({ where: { name: input } });
      if (cosmetic) {
        await cosmetic.destroy();
        return message.channel.send({
          embeds: [
            new EmbedBuilder()
              .setTitle("üõí Cosm√©tico removido da loja!")
              .setDescription(`‚úÖ O cosm√©tico **${input}** foi removido da loja com sucesso.`)
              .setColor("Red"),
          ],
        });
      }

      return message.reply(`‚ùå O item, cosm√©tico ou cargo **${input}** n√£o existe na loja.`);
    } catch (err) {
      console.error("Erro ao remover item da loja:", err);
      return message.reply("‚ùå Ocorreu um erro ao tentar remover o item da loja.");
    }
  }
};
