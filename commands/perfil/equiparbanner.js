import { EmbedBuilder } from "discord.js";
import { User, Cosmetic, Inventory, getUser } from "../../utils/database.js";

export default {
  name: "equipar",
  description: "Equipe um banner ou √≠cone do invent√°rio",
  async execute(message, args) {
    if (args.length < 2) {
      return message.reply("‚ùå Use: `!equipar banner {nome}` ou `!equipar icon {nome}`");
    }

    const tipo = args[0].toLowerCase();
    const nome = args.slice(1).join(" ");

    if (!["banner", "icon"].includes(tipo)) {
      return message.reply("‚ùå Tipo inv√°lido! Use `banner` ou `icon`.");
    }

    // Procurar cosm√©tico pelo nome e tipo
    const cosmetic = await Cosmetic.findOne({ where: { name: nome, type: tipo } });
    if (!cosmetic) {
      return message.reply("‚ùå Cosm√©tico n√£o encontrado.");
    }

    // Verificar se o usu√°rio possui esse cosm√©tico
    const possui = await Inventory.findOne({
      where: { userId: message.author.id, cosmeticId: cosmetic.id }
    });
    if (!possui) {
      return message.reply("‚ùå Voc√™ n√£o possui esse cosm√©tico.");
    }

    // Garantir que o usu√°rio exista
    const user = await getUser(message.author.id);

    // Equipar o cosm√©tico
    if (tipo === "banner") {
      user.equippedBanner = cosmetic.id;
    } else {
      user.equippedIcon = cosmetic.id;
    }
    await user.save();

    const embed = new EmbedBuilder()
      .setTitle("üé® Cosm√©tico equipado!")
      .setDescription(`Voc√™ equipou o **${cosmetic.name}** (${tipo}).`)
      .setImage(cosmetic.url)
      .setColor("Blue");

    return message.channel.send({ embeds: [embed] });
  }
};
